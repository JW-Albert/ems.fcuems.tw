# ğŸ”§ æ¨¡çµ„åŒ–é‡æ§‹èªªæ˜

## ğŸ“‹ é‡æ§‹æ¦‚è¿°

åŸæœ¬çš„ `app.py` æª”æ¡ˆéæ–¼å†—é•·ï¼ˆ1575è¡Œï¼‰ï¼Œå·²æˆåŠŸé‡æ§‹ç‚ºæ¨¡çµ„åŒ–æ¶æ§‹ï¼Œæé«˜ç¨‹å¼ç¢¼çš„å¯ç¶­è­·æ€§å’Œå¯è®€æ€§ã€‚

## ğŸ—ï¸ æ–°æ¶æ§‹çµæ§‹

### 1. **é…ç½®ç®¡ç†æ¨¡çµ„** (`config.py`)
- **åŠŸèƒ½**ï¼šçµ±ä¸€ç®¡ç†æ‰€æœ‰é…ç½®åƒæ•¸
- **ç‰¹é»**ï¼š
  - è‡ªå‹•è¼‰å…¥ `.env` æª”æ¡ˆ
  - é…ç½®é©—è­‰åŠŸèƒ½
  - è‡ªå‹•å‰µå»ºå¿…è¦ç›®éŒ„
  - é›†ä¸­ç®¡ç†æ‰€æœ‰ç’°å¢ƒè®Šæ•¸

### 2. **æ—¥èªŒç®¡ç†æ¨¡çµ„** (`logger.py`)
- **åŠŸèƒ½**ï¼šå®Œæ•´çš„æ—¥èªŒç³»çµ±ç®¡ç†
- **ç‰¹é»**ï¼š
  - æ”¯æ´Cloudflare Tunnel
  - æ¯æ—¥æ—¥èªŒæª”æ¡ˆè¼ªæ›¿
  - è©³ç´°çš„ä½¿ç”¨è€…å‹•ä½œè¨˜éŒ„
  - æ—¥èªŒæª”æ¡ˆç®¡ç†åŠŸèƒ½

### 3. **æ¡ˆä»¶ç®¡ç†æ¨¡çµ„** (`case_manager.py`)
- **åŠŸèƒ½**ï¼šæ¡ˆä»¶ç´€éŒ„çš„å®Œæ•´ç®¡ç†
- **ç‰¹é»**ï¼š
  - æ¡ˆä»¶æª”æ¡ˆä¿å­˜å’Œè®€å–
  - æ¡ˆä»¶è³‡æ–™è§£æï¼ˆç°¡åŒ–ç‰ˆå’Œå®Œæ•´ç‰ˆï¼‰
  - æ¡ˆä»¶çµ±è¨ˆåŠŸèƒ½
  - æ¡ˆä»¶æª”æ¡ˆæ¸…ç†åŠŸèƒ½

### 4. **è¨Šæ¯å»£æ’­æ¨¡çµ„** (`message_broadcaster.py`)
- **åŠŸèƒ½**ï¼šLINEå’ŒDiscordè¨Šæ¯ç™¼é€
- **ç‰¹é»**ï¼š
  - çµ±ä¸€çš„è¨Šæ¯å»£æ’­ä»‹é¢
  - æ¸¬è©¦åŠŸèƒ½
  - è¨Šæ¯æ ¼å¼åŒ–
  - å»£æ’­æ§åˆ¶åŠŸèƒ½

### 5. **APIè·¯ç”±æ¨¡çµ„** (`api_routes.py`)
- **åŠŸèƒ½**ï¼šæ‰€æœ‰APIç«¯é»çš„è™•ç†
- **ç‰¹é»**ï¼š
  - RESTful APIè¨­è¨ˆ
  - JSONæ ¼å¼å›æ‡‰
  - åˆ†é æ”¯æ´
  - çµ±è¨ˆåŠŸèƒ½

### 6. **ä¸»ç¨‹å¼** (`app.py`)
- **åŠŸèƒ½**ï¼šFlaskæ‡‰ç”¨ç¨‹å¼ä¸»é«”
- **ç‰¹é»**ï¼š
  - ç°¡åŒ–çš„è·¯ç”±å®šç¾©
  - æ¨¡çµ„åŒ–å°å…¥
  - æ¸…æ™°çš„ç¨‹å¼çµæ§‹

## ğŸ“Š é‡æ§‹å‰å¾Œå°æ¯”

| é …ç›® | é‡æ§‹å‰ | é‡æ§‹å¾Œ |
|------|--------|--------|
| ä¸»ç¨‹å¼è¡Œæ•¸ | 1575è¡Œ | ~200è¡Œ |
| æ¨¡çµ„æ•¸é‡ | 1å€‹ | 6å€‹ |
| å¯ç¶­è­·æ€§ | ä½ | é«˜ |
| å¯è®€æ€§ | ä½ | é«˜ |
| åŠŸèƒ½åˆ†é›¢ | ç„¡ | å®Œæ•´ |

## ğŸš€ ä½¿ç”¨æ–¹å¼

### 1. **å®‰è£ä¾è³´**
```bash
pip install -r requirements.txt
```

### 2. **é…ç½®ç’°å¢ƒè®Šæ•¸**
ç¢ºä¿ `data/.env` æª”æ¡ˆåŒ…å«å¿…è¦çš„é…ç½®ï¼š
```env
LINE_BOT_API_TOKEN=your_token_here
LINE_WEBHOOK_HANDLER=your_handler_here
LINE_GROUP_ID=your_group_id_here
DISCORD_WEBHOOK_URL=your_webhook_url_here
SECRET_KEY=your_secret_key_here
```

### 3. **å•Ÿå‹•æ‡‰ç”¨ç¨‹å¼**
```bash
python app.py
```

## ğŸ”§ æ¨¡çµ„åŠŸèƒ½èªªæ˜

### é…ç½®ç®¡ç† (`config.py`)
```python
from config import config

# ç²å–é…ç½®
secret_key = config.SECRET_KEY
line_token = config.LINE_BOT_API_TOKEN

# é©—è­‰é…ç½®
config.validate_config()
```

### æ—¥èªŒç®¡ç† (`logger.py`)
```python
from logger import logger_manager

# è¨˜éŒ„ä½¿ç”¨è€…å‹•ä½œ
logger_manager.log_user_action("é é¢è¨ªå•", "ä¸»é é¢")

# è¨˜éŒ„éŒ¯èª¤
logger_manager.log_error("éŒ¯èª¤è¨Šæ¯", "ä¸Šä¸‹æ–‡")

# ç²å–ä½¿ç”¨è€…è³‡è¨Š
user_info = logger_manager.get_user_info()
```

### æ¡ˆä»¶ç®¡ç† (`case_manager.py`)
```python
from case_manager import case_manager

# ä¿å­˜æ¡ˆä»¶ç´€éŒ„
filename = case_manager.save_case_record(case_data)

# è®€å–æ¡ˆä»¶æª”æ¡ˆ
content = case_manager.read_case_file(filename)

# è§£ææ¡ˆä»¶è³‡æ–™
case_info = case_manager.parse_case_record(content)

# ç²å–çµ±è¨ˆè³‡æ–™
stats = case_manager.get_case_stats("2024-01-15", "2024-01-16")
```

### è¨Šæ¯å»£æ’­ (`message_broadcaster.py`)
```python
from message_broadcaster import message_broadcaster

# å»£æ’­è¨Šæ¯
results = message_broadcaster.broadcast_message(message_content, case_data)

# æ¸¬è©¦LINE
result = message_broadcaster.test_line_message()

# æ¸¬è©¦Discord
result = message_broadcaster.test_discord_message()

# æ ¼å¼åŒ–æ¡ˆä»¶è¨Šæ¯
message = message_broadcaster.format_case_message(case_data)
```

## ğŸ“ æª”æ¡ˆçµæ§‹

```
ems.fcuems.tw/
â”œâ”€â”€ app.py                 # ä¸»ç¨‹å¼ï¼ˆé‡æ§‹å¾Œï¼‰
â”œâ”€â”€ app_backup.py          # åŸå§‹ç¨‹å¼å‚™ä»½
â”œâ”€â”€ config.py              # é…ç½®ç®¡ç†æ¨¡çµ„
â”œâ”€â”€ logger.py              # æ—¥èªŒç®¡ç†æ¨¡çµ„
â”œâ”€â”€ case_manager.py        # æ¡ˆä»¶ç®¡ç†æ¨¡çµ„
â”œâ”€â”€ message_broadcaster.py # è¨Šæ¯å»£æ’­æ¨¡çµ„
â”œâ”€â”€ api_routes.py          # APIè·¯ç”±æ¨¡çµ„
â”œâ”€â”€ test_modules.py        # æ¨¡çµ„æ¸¬è©¦è…³æœ¬
â”œâ”€â”€ requirements.txt       # ä¾è³´æ¸…å–®
â”œâ”€â”€ data/
â”‚   â””â”€â”€ .env              # ç’°å¢ƒè®Šæ•¸é…ç½®
â”œâ”€â”€ logs/                 # æ—¥èªŒæª”æ¡ˆç›®éŒ„
â”œâ”€â”€ record/               # æ¡ˆä»¶ç´€éŒ„ç›®éŒ„
â””â”€â”€ templates/            # æ¨¡æ¿æª”æ¡ˆ
```

## âœ… é‡æ§‹å„ªå‹¢

1. **å¯ç¶­è­·æ€§æå‡**ï¼šæ¯å€‹æ¨¡çµ„è·è²¬å–®ä¸€ï¼Œæ˜“æ–¼ç¶­è­·
2. **å¯è®€æ€§æå‡**ï¼šç¨‹å¼ç¢¼çµæ§‹æ¸…æ™°ï¼Œæ˜“æ–¼ç†è§£
3. **å¯æ“´å±•æ€§æå‡**ï¼šæ–°åŠŸèƒ½å¯ä»¥ç¨ç«‹æ¨¡çµ„é–‹ç™¼
4. **å¯æ¸¬è©¦æ€§æå‡**ï¼šæ¯å€‹æ¨¡çµ„å¯ä»¥ç¨ç«‹æ¸¬è©¦
5. **ç¨‹å¼ç¢¼é‡ç”¨**ï¼šæ¨¡çµ„å¯ä»¥åœ¨å…¶ä»–å°ˆæ¡ˆä¸­é‡ç”¨

## ğŸ”„ é·ç§»æŒ‡å—

å¦‚æœæ‚¨éœ€è¦å¾åŸå§‹ç‰ˆæœ¬é·ç§»åˆ°æ¨¡çµ„åŒ–ç‰ˆæœ¬ï¼š

1. **å‚™ä»½åŸå§‹æª”æ¡ˆ**ï¼š`app_backup.py` å·²è‡ªå‹•å‰µå»º
2. **æª¢æŸ¥é…ç½®**ï¼šç¢ºä¿ `data/.env` æª”æ¡ˆæ­£ç¢ºé…ç½®
3. **æ¸¬è©¦åŠŸèƒ½**ï¼šä½¿ç”¨ `test_modules.py` é©—è­‰æ¨¡çµ„è¼‰å…¥
4. **é€æ­¥é·ç§»**ï¼šå¯ä»¥é€æ­¥å°‡åŠŸèƒ½é·ç§»åˆ°æ–°æ¶æ§‹

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

1. **æ¨¡çµ„è¼‰å…¥å¤±æ•—**
   - æª¢æŸ¥Pythonè·¯å¾‘
   - ç¢ºèªæ‰€æœ‰ä¾è³´å·²å®‰è£

2. **é…ç½®éŒ¯èª¤**
   - æª¢æŸ¥ `data/.env` æª”æ¡ˆ
   - ç¢ºèªæ‰€æœ‰å¿…è¦é…ç½®å·²è¨­å®š

3. **æ¬Šé™å•é¡Œ**
   - æª¢æŸ¥ç›®éŒ„å‰µå»ºæ¬Šé™
   - ç¢ºèªæª”æ¡ˆè®€å¯«æ¬Šé™

## ğŸ“ æ”¯æ´

å¦‚æœ‰å•é¡Œï¼Œè«‹æª¢æŸ¥ï¼š
1. éŒ¯èª¤æ—¥èªŒï¼ˆ`logs/` ç›®éŒ„ï¼‰
2. æ¨¡çµ„æ¸¬è©¦çµæœ
3. é…ç½®æª”æ¡ˆè¨­å®š

---

**æ³¨æ„**ï¼šé‡æ§‹å¾Œçš„ç¨‹å¼ç¢¼ä¿æŒäº†æ‰€æœ‰åŸæœ‰åŠŸèƒ½ï¼Œä½†çµæ§‹æ›´åŠ æ¸…æ™°å’Œå¯ç¶­è­·ã€‚å»ºè­°åœ¨ç”Ÿç”¢ç’°å¢ƒä½¿ç”¨å‰é€²è¡Œå……åˆ†æ¸¬è©¦ã€‚
